<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <meta name="description" content="">
  <meta name="author" content="">
  <link rel="icon" href="../assets/img/favicon.ico">

  <title>CSP成绩分析</title>

  <!-- Bootstrap core CSS -->
  <link href="../dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
  <link href="../assets/css/ie10-viewport-bug-workaround.css" rel="stylesheet">

  <!-- Custom styles for this template -->
  <link href="../assets/css/my/dashboard.css" rel="stylesheet">

  <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
  <!--[if lt IE 9]><script src="../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
  <script src="../assets/js/ie-emulation-modes-warning.js"></script>

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
  <style>
    .charts-place {
      margin: 0 20%;
    }
  </style>
</head>
<body>
  <!-- start 顶部导航栏 -->
  <nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <img style="float: left;height: 50px;width:70px;padding: 5px 15px;" src="../assets/img/ccfsxu.png" alt="" class="img-circle" width="40" height="40">
        <a class="navbar-brand" href="../index.html" style="cursor: default;">CCFSXU会员管理系统</a>
      </div>
      <div id="navbar" class="navbar-collapse collapse">
        <ul class="nav navbar-nav navbar-right" id="update-password-link" hidden>
          <li><a href="#">修改密码</a></li>
        </ul>
        <ul class="nav navbar-nav navbar-right" id="login-link"></ul>
        <ul class="nav navbar-nav navbar-right">
          <li><a href="../master/main.html">管理端</a></li>
        </ul>
        <ul class="nav navbar-nav navbar-right">
          <li><a href="../member/application.html">CSP预报名</a></li>
        </ul>
        <ul class="nav navbar-nav navbar-right">
          <li><a href="../member/analyScore.html">CSP成绩分析</a></li>
        </ul>
        <ul class="nav navbar-nav navbar-right">
          <li><a href="../member/book.html">图书馆</a></li>
        </ul>
        <!-- <form class="navbar-form navbar-right">
            <input type="text" class="form-control" placeholder="Search...">
        </form> -->
      </div>
    </div>
  </nav>
  <!-- end 顶部导航栏 -->

  <!-- <h1 align="center">功能正在完善...</h1><hr> -->
  <div class="charts-place" align="center">
    <div id="chart_1" style="width: 100%; height: 400px;">

    </div>
    <hr>
    <!-- 下拉菜单 选择题目 -->
    <div class="dropdown" style="float:left;">
        <button type="button" class="btn dropdown-toggle questionNo" id="dropdownMenu" data-toggle="dropdown">题目
            <span class="caret"></span>
        </button>
        <ul class="dropdown-menu questionNo" role="menu" aria-labelledby="dropdownMenu">
            <li role="presentation">
                <a class="select-questionNo" id="select-questionNo-1" role="menuitem" tabindex="-1" style="cursor: pointer;">第1题</a>
            </li>
            <li role="presentation">
                <a class="select-questionNo" id="select-questionNo-2" role="menuitem" tabindex="-1" style="cursor: pointer;">第2题</a>
            </li>
            <li role="presentation">
                <a class="select-questionNo" id="select-questionNo-3" role="menuitem" tabindex="-1" style="cursor: pointer;">第3题</a>
            </li>
            <li role="presentation">
                <a class="select-questionNo" id="select-questionNo-4" role="menuitem" tabindex="-1" style="cursor: pointer;">第4题</a>
            </li>
            <li role="presentation">
                <a class="select-questionNo" id="select-questionNo-5" role="menuitem" tabindex="-1" style="cursor: pointer;">第5题</a>
            </li>
        </ul>
    </div>
    <div style="clear:both;"></div>
    <br>
    <!-- <select id="select-questionNo">
      <option value="0">第1题</option>
      <option value="1">第2题</option>
      <option value="2">第3题</option>
      <option value="3">第4题</option>
      <option value="4">第5题</option>
    </select> -->
    <div id="chart_2_2" style="width: 100%; height: 400px;">

    </div>
    <hr><!-- 下拉菜单 选择参加过的CSP考试 -->
    <div class="dropdown" style="float:left;">

        <button type="button" class="btn dropdown-toggle certNo" id="dropdownMenu1" data-toggle="dropdown">CSP认证考试
            <span class="caret"></span>
        </button>
        <ul class="dropdown-menu certNo" role="menu" aria-labelledby="dropdownMenu1">
            <!-- <li role="presentation">
                <a class="select-certNo" id="select-certNo-1" role="menuitem" tabindex="-1" style="cursor: pointer;">第1题</a>
            </li> -->
        </ul>
    </div>
    <div style="clear:both;"></div>
    <br>
    <!-- <select id="select-certNo">
      <option value="0">0</option>
      <option value="1">1</option>
      <option value="2">2</option>
    </select> -->
    <div id="chart_2" style="width: 100%; height: 400px;">

    </div>
    <br>
    <div id="chart_3" style="width: 100%; height: 400px;">

    </div>
  </div>


  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script type="text/javascript" src="../assets/js/vendor/jquery-3.2.1.min.js"></script>
  <!-- <script>window.jQuery || document.write('<script src="./assets/js/vendor/jquery.min.js"><\/script>')</script> -->
  <script src="../dist/js/bootstrap.min.js"></script>
  <!-- Just to make our placeholder images work. Don't actually copy the next line! -->
  <script src="../assets/js/vendor/holder.min.js"></script>
  <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
  <script src="../assets/js/ie10-viewport-bug-workaround.js"></script>
  <script src="../assets/js/bootbox.min.js"></script>

  <!-- Echarts js -->
  <script src="../assets/js/my/echarts.min.js"></script>
  <script src="../assets/js/my/drawCharts.js"></script>
  <script src="../assets/js/ccfsxu.js"></script>
  <!--<script src="../assets/js/my/analyScore.js"></script>-->
  <script type="text/javascript">
    $(document).ready(function(){

      url = myUrl+"/csp/memberScore";
      var data;
      var chart_1 = echarts.init(document.getElementById('chart_1'));
      var chart_2 = echarts.init(document.getElementById('chart_2'));
      var chart_2_2 = echarts.init(document.getElementById('chart_2_2'));
      var chart_3 = echarts.init(document.getElementById('chart_3'));

      $.post(url, function(result){
        console.log(result);
        if (result.code == CODE_SUCCESS) {
          var certNameArray = new Array();
          var maxArray = new Array();
          var averageArray = new Array();
          var allArray = new Array();
          var minArray = new Array();
          var firstArray = new Array();
          var secondArray = new Array();
          var thirdArray = new Array();
          var forthArray = new Array();
          var fifthArray = new Array();
          for (var i = 0; i < result.data.length; i++) {
            certName = result.data[i].certName;
            // console.log(certName.substring(0, certName.indexOf("CCF")));
            certNameArray.push(certName.substring(0, certName.indexOf("CCF")));
            maxArray.push(result.data[i].max.all);
            averageArray.push(result.data[i].average.all);
            allArray.push(result.data[i].all);
            minArray.push(result.data[i].min.all);

            firstArray.push(result.data[i].first);
            secondArray.push(result.data[i].second);
            thirdArray.push(result.data[i].third);
            forthArray.push(result.data[i].forth);
            fifthArray.push(result.data[i].fifth);
          }
          firstArray.push(100);
          secondArray.push(100);
          thirdArray.push(100);
          forthArray.push(100);
          fifthArray.push(100);

          // ######################## 画图 ##########################
          // 总分走势 折线图
          drawChart1(chart_1, certNameArray, maxArray, averageArray, allArray, minArray);
          // 题目得分走势 折线图
          $(".btn.dropdown-toggle.questionNo").html('第1题\n<span class="caret"></span>');
          drawChart2_2(chart_2_2, certNameArray, firstArray);
          // 能力分布 蜘蛛网图
          scores = result.data[result.data.length-1];
          $(".btn.dropdown-toggle.certNo").html(scores.certName + '\n<span class="caret"></span>');
          drawChart2(chart_2, scores);
          // 平均对比 柱状图
          drawChart3(chart_3, scores);


          // 题目得分走势 折线图 选择器
          $("a.select-questionNo").click(function(){
            $(".btn.dropdown-toggle.questionNo").html($(this).text() + '\n<span class="caret"></span>');
            var domId = $(this).attr('id');
            switch(parseInt(domId.substring(domId.lastIndexOf("-") + 1))-1) {
              case 0:
                scoreArray = firstArray; break;
              case 1:
                scoreArray = secondArray; break;
              case 2:
                scoreArray = thirdArray; break;
              case 3:
                scoreArray = forthArray; break;
              case 4:
                scoreArray = fifthArray; break;
            }
            chart_2_2.setOption({
              legend: {
                data:[$(this).text()]
              },
              series: [
                {
                  name: $(this).text(),
                  type:'line',
                  data: scoreArray
                }
              ]
            }); // chart_2_2
          });
          // $("select#select-questionNo").change(function(){ // 改变事件
          //     switch(parseInt($("select#select-questionNo").val())) {
          //     case 0:
          //         scoreArray = firstArray; break;
          //     case 1:
          //         scoreArray = secondArray; break;
          //     case 2:
          //         scoreArray = thirdArray; break;
          //     case 3:
          //         scoreArray = forthArray; break;
          //     case 4:
          //         scoreArray = fifthArray; break;
          //     }
          //     chart_2_2.setOption({
          //         legend: {
          //             data:[$("select#select-questionNo").find("option:selected").text()]
          //         },
          //         series: [
          //             {
          //                 name: $("select#select-questionNo").find("option:selected").text(),
          //                 type:'line',
          //                 data: scoreArray
          //             }
          //         ]
          //     }); // chart_2_2
          // });

          // 能力分布 蜘蛛网图 选择器
          for (var i = 0; i < result.data.length; i++) {
            // $("select#select-certNo").append(
            //     '<option value="' + i + '">' + result.data[i].certName + '</option>'
            // );
            $(".dropdown-menu.certNo").append(
              '<li role="presentation">\
                  <a class="select-certNo" id="select-certNo-' + i + '" role="menuitem" tabindex="-1" style="cursor: pointer;">' + result.data[i].certName + '</a>\
                    </li>'
            );
          }
          $("a.select-certNo").click(function(){
            $(".btn.dropdown-toggle.certNo").html($(this).text() + '\n<span class="caret"></span>');
            var domId = $(this).attr('id');
            var no = parseInt(domId.substring(domId.lastIndexOf("-") + 1));
            scores = result.data[no];
            chart_2.setOption({
              series: [{
                type: 'radar',
                data : [
                  {
                    value : [scores.first, scores.second, scores.third, scores.forth, scores.fifth],
                    name : '我的成绩（Score）'
                  }
                ]
              }]
            }); // chart_2
            chart_3.setOption({
              series : [
                {
                  name:'最高分',
                  type:'bar',
                  data: [scores.max.first, scores.max.second, scores.max.third, scores.max.forth, scores.max.fifth]
                },
                {
                  name:'平均分',
                  type:'bar',
                  data: [scores.average.first, scores.average.second, scores.average.third, scores.average.forth, scores.average.fifth]
                },
                {
                  name:'我的得分',
                  type:'bar',
                  data: [scores.first, scores.second, scores.third, scores.forth, scores.fifth]
                },
                {
                  name:'最低分',
                  type:'bar',
                  data: [scores.min.first, scores.min.second, scores.min.third, scores.min.forth, scores.min.fifth]
                }
              ]
            }); // chart_3
          });
          // $("select#select-certNo").change(function(){ // 改变事件
          //     var no = parseInt($("select#select-certNo").val());
          //     scores = result.data[no];
          //     // console.log(scores);
          //     chart_2.setOption({
          //         series: [{
          //             type: 'radar',
          //             // areaStyle: {normal: {}},
          //             data : [
          //                 {
          //                     value : [scores.first, scores.second, scores.third, scores.forth, scores.fifth],
          //                     name : '我的成绩（Score）'
          //                 }
          //             ]
          //         }]
          //     }); // chart_2
          //     chart_3.setOption({
          //         series : [
          //             {
          //                 name:'最高分',
          //                 type:'bar',
          //                 data: [scores.max.first, scores.max.second, scores.max.third, scores.max.forth, scores.max.fifth]
          //             },
          //             {
          //                 name:'平均分',
          //                 type:'bar',
          //                 data: [scores.average.first, scores.average.second, scores.average.third, scores.average.forth, scores.average.fifth]
          //             },
          //             {
          //                 name:'我的得分',
          //                 type:'bar',
          //                 data: [scores.first, scores.second, scores.third, scores.forth, scores.fifth]
          //             },
          //             {
          //                 name:'最低分',
          //                 type:'bar',
          //                 data: [scores.min.first, scores.min.second, scores.min.third, scores.min.forth, scores.min.fifth]
          //             }
          //         ]
          //     }); // chart_3
          // });

        } else {
          console.log("没有数据");
        } // if

      }); // post

    });
  </script>
</body>
</html>
